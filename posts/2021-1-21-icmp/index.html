<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>网际控制报文协议ICMP | Play With YYF</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="计算机网络/网络层/网际控制报文协议ICMP">
<meta name=generator content="Hugo 0.92.2">
<meta name=robots content="noindex, nofollow">
<link rel=stylesheet href=/ananke/css/main.min.css>
<meta property="og:title" content="网际控制报文协议ICMP">
<meta property="og:description" content="计算机网络/网络层/网际控制报文协议ICMP">
<meta property="og:type" content="article">
<meta property="og:url" content="http://yyf.zone/posts/2021-1-21-icmp/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-01-21T08:48:12+00:00">
<meta property="article:modified_time" content="2021-01-21T08:48:12+00:00">
<meta itemprop=name content="网际控制报文协议ICMP">
<meta itemprop=description content="计算机网络/网络层/网际控制报文协议ICMP"><meta itemprop=datePublished content="2021-01-21T08:48:12+00:00">
<meta itemprop=dateModified content="2021-01-21T08:48:12+00:00">
<meta itemprop=wordCount content="27">
<meta itemprop=keywords content="笔记,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="网际控制报文协议ICMP">
<meta name=twitter:description content="计算机网络/网络层/网际控制报文协议ICMP">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Play With YYF
</a>
<div class="flex-l items-center">
<div class=ananke-socials>
</div>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class="mt3 ananke-socials">
</div>
<h1 class="f1 athelas mt3 mb1">网际控制报文协议ICMP</h1>
<time class="f6 mv4 dib tracked" datetime=2021-01-21T08:48:12Z>January 21, 2021</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>计算机网络/网络层/网际控制报文协议ICMP</p>
<p>  为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了<strong>网际控制报文协议ICMP</strong>(Internet Control Message Protocol)。<strong>ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告</strong>。ICMP是IP层的协议。ICMP报文作为IP数据报的数据，加上数据报的首部，组成IP数据报发送出去。</p>
<h1 id=icmp报文>ICMP报文</h1>
<p><img src=/image/ICMP%E6%8A%A5%E6%96%87.png alt=ICMP报文></p>
<h1 id=icmp报文种类>ICMP报文种类</h1>
<p>ICMP报文的种类有两种，即<strong>ICMP差错报文</strong>和<strong>ICMP询问报文</strong>。<br>
ICMP差错报文共有四种：</p>
<ol>
<li><strong>终点不可达</strong>。当路由器或主机不能交付数据报时就向源点发送终点不可达报文。</li>
<li><strong>时间超过</strong>。当路由器收到生存时间为零的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片丢弃，并向源点发送时间超过报文。</li>
<li><strong>参数问题</strong>。当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文。</li>
<li><strong>改变路由</strong>（重定向）。路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）。</li>
</ol>
<p>常用的ICMP询问报文有两种：</p>
<ol>
<li><strong>回送请求和回答</strong>。ICMP回送请求报文是由报文或路由器向一个特定的目的主机发出的询问。收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。这种询问报文用来测试目的站是否可达以及了解其有关状态。</li>
<li><strong>时间戳请求和回答</strong>。ICMP时间戳请求报文是请某台主机或路由器回答当前的日期和时间。在ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。时间戳请求与回答可用于时钟同步和时间测量。</li>
</ol>
<h1 id=icmp应用举例>ICMP应用举例</h1>
<h2 id=分组网间探测ping>分组网间探测PING</h2>
<p>  ICMP的一个重要应用就是<strong>分组网间探测PING</strong>(Packet InterNet Groper)，<strong>用来测试两台主机之间的连通性</strong>。PING使用了<strong>ICMP回送请求与回送回答报文</strong>。PING是应用层直接使用网络层ICMP的一个例子。它没有通过运输层的TCP或UDP。</p>
<h2 id=traceroute>traceroute</h2>
<p>  另一个非常有用的应用是<strong>traceroute</strong>（这是UNIX操作系统中的名字），它用来跟踪一个分组从源点到终点的路径。在Windows操作系统中这个命令是<strong>tracert</strong>。<br>
  Traceroute从源主机向目的主机发送一连串的IP数据报，数据报中封装的是无法交付的UDP用户数据报。第一个数据报P1的生存时间TTL设置为1.当P1到达路径上的第一个路由器R1时，R1先收下它，接着把TLL减1.由于TTL等于零了，R1就把P1丢弃了，并向源主机发送一个<strong>ICMP时间超过差错报告报文</strong>。<br>
  源主机接着发送第二个数据报P2，并把TTL设置成2。这样一直继续下去。当最后一个数据报刚刚到达目的主机时，数据报的TTL是1。主机不转发数据报，也不把TTL值减1。但因IP数据报中封装的是无法交付的运输层的UDP用户数据报，因此目的主机要向源主机发送<strong>ICMP终点不可达差错报告报文</strong>。<br>
  这样，源主机达到了自己的目的，因为这些路由器和最后目的主机发来的ICMP报文正好给出了源主机想知道的路由信息————<strong>到达目的主机所经过的路由器的IP地址</strong>。</p>
<p>参考文献：《计算机网络（第7版）》谢希仁著。</p><ul class=pa0>
<li class="list di">
<a href=/tags/%E7%AC%94%E8%AE%B0 class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">笔记</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/posts/2021-1-19-route/>互联网的路由选择协议</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-19-p2p/>P2P应用</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-18-socket/>应用进程跨越网络的通信</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-18-snmp/>简单网络管理协议SNMP</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-16-dhcp/>动态主机配置协议DHCP</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-16-email/>电子邮件</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-15-www/>万维网WWW</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-14-ftp/>文件传送协议FTP</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-13-dns/>域名系统DNS</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-12-connectionmanagement/>TCP的运输连接管理</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-11-congestioncontrol/>TCP的拥塞控制</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-10-flowcontrol/>TCP的流量控制</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-10-reliabletransmission/>TCP可靠传输的实现</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-9-headoftcp/>TCP报文段的首部格式</a>
</li>
<li class=mb2>
<a href=/posts/2021-1-8-overviewoftcp/>传输控制协议TCP概述</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://yyf.zone/>
&copy; Play With YYF 2022
</a>
<div>
<div class=ananke-socials>
</div></div>
</div>
</footer>
</body>
</html>