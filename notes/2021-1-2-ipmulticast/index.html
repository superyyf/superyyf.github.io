<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>IP多播 | Play With YYF</title><meta name=keywords content="笔记"><meta name=description content="网络层/IP多播"><meta name=author content><link rel=canonical href=http://yyf.zone/notes/2021-1-2-ipmulticast/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://yyf.zone/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://yyf.zone/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://yyf.zone/favicon-32x32.png><link rel=apple-touch-icon href=http://yyf.zone/apple-touch-icon.png><link rel=mask-icon href=http://yyf.zone/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="IP多播"><meta property="og:description" content="网络层/IP多播"><meta property="og:type" content="article"><meta property="og:url" content="http://yyf.zone/notes/2021-1-2-ipmulticast/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2021-01-02T18:03:36+00:00"><meta property="article:modified_time" content="2021-01-02T18:03:36+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="IP多播"><meta name=twitter:description content="网络层/IP多播"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"http://yyf.zone/notes/"},{"@type":"ListItem","position":2,"name":"IP多播","item":"http://yyf.zone/notes/2021-1-2-ipmulticast/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"IP多播","name":"IP多播","description":"网络层/IP多播\n","keywords":["笔记"],"articleBody":"网络层/IP多播\nIP多播 一个源点发送到多个终点，即一对多的通信。与单播相比，在一对多的通信中，多播可大大节约网络资源。\n基本概念 多播路由器(multicast router) 在互联网范围的多播要靠路由器来实现，这些路由起必须增加一些能够识别多播数据报的软件，能够运行多播协议的路由器称为多播路由器。多播路由器当然也可以转发普通的单播IP数据包\n多播主干网(Multicast Backbone On the InterNET) MBONE可把分组传播给地点分散但属于一个组的许多台主机。\n多播地址 多播组的标识符就是IP地址中的D类地址。D类地址的前四位是1110，每一个D类地址标志一个多播组。多播地址只能用于目的地址，而不能用于源地址。\n多播数据报 多播数据报和一般的IP数据报的区别就是它使用D类IP地址作为目的地址，并且首部中的协议字段值是2，表明使用网际组管理协议IGMP。此外，对多播数据报不产生ICMP差错报文。因此，若在PING命令后面键入多播地址，将永远不会收到响应。\n局域网上的硬件多播 D类IP地址与以太网多播地址的映射关系。互联网号码指派管理局IANA拥有的以太网地址块的高24位为00-00-5E，第一个字节的最低位为1时即为多播地址，即01-00-5E-00-00-00到01-00-5E-7F-FF-FF。\n由于多播IP地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃。\n3. 网际组管理协议IGMP IP多播需要两种协议，网际组管理协议IGMP和多播路由选择协议。IGMP协议并非在互联网范围内对所有多播组成员进行管理的协议。IGMP不知道多播组包含的成员数，也不知道这些成员都分布在那些网络上，等等。IGMP协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机（严格讲，是主机上的某个进程）参加或退出了某个多播组。\n显然，仅有IGMP协议是不能完成多播任务的。连接在局域网上的多播路由器还必须和互联网上的其他多播路由器协同工作，这就需要多播路由选择协议。\nIGMP协议和ICMP协议相似，使用IP数据报传递其报文。属于网际协议IP的一个组成部分。 IGMP的工作分成两个阶段：\n第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个IGMP报文，声明自己要称为改组成员。 第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否还继续是组的成员。 IGMP协议还采取了一些措施来避免多播控制信息给网络增加大量的开销：\n在主机和多播路由器之间的所有通信都是使用IP多播。 多播路由器在探询组成员关系时，只需要对所有的组发送一个请求信息的询问报文，而不需要每个组都发送一个。 当同一个网络上连接有多个多播路由器时，它们能迅速和有效地选择其中的一个来探询主机的成员关系。 在IGMP的询问报文中有一个数值N，它指明一个最长响应时间。当收到询问时，主机在0到N之间随机选择发送响应所需要经过的时延。因此，若一台主机同时参加了多个多播组，则主机对每一个多播组选择不同的随机数。对应最小时延的响应最先发送。 同一组内的每一台主机都要监听响应，只要有本组的其他主机先发送了响应，自己就可以不再发送响应了。 IGMP的报文格式可参阅有关文档RFC 3376。\n4. 多播路由选择协议 多播路由选择协议实际上就是要找出以源主机为根节点的多播转发树。\n多播转发树 在多播转发树上，每一个多播路由器向树的叶节点方向转发收到的多播数据报，但在多播转发树上的路由器不会收到重复的多播数据报（即多播数据报不应在互联网中兜圈子）。\n已有多种实用的多播路由选择协议，它们在转发多播数据报时使用以下的三种方法;\n泛洪与剪除。这种方法适合较小的多播组，而所有的组成员接入的局域网也是相邻接的。一开始，路由器转发多播数据报使用泛洪的方法（这就是广播）。\n为避免兜圈子，采用反向路径广播RPB(Reverse Path Broadcasting)策略。RPB的要点是：每一个路由器在收到一个多播数据报时，先检查数据报是否是从源点经最短路径传送来的。进行这种检查很容易，只要从本路由器寻找到源点的最短路径上（之所以叫做反向路径，因为在计算最短路径时是把源点当作终点）的第一个路由器是否就是刚才把数据送来的路由器。若是，就向所有其他方向转发刚才收到的多播数据报，否则就丢弃而不转发。\n如果在多播转发树上的某个路由器发现它的下游树枝（即叶节点方向）已没有该多播组的成员，就应把它和下游的树枝一起剪除。 隧道技术。隧道技术适用于多播组在地理上很分散的情况。在通过不支持多播的网络时，将多播数据报进行再次封装，即加上普通数据报首部，使之成为向单一目的站发送单播数据报。通过该网络后，剥去首部，使它恢复成原来的多播数据报，继续向多个目的站转发。 基于核心的发现技术。这种方法对于多播组的大小在较大范围内变化时都适合。这种方法是对每一个多播组G指定一个核心(core)路由器，给出它的IP单播地址。核心路由器按照前面讲过的方法创建出对应于多播组G的转发树。假设核心路由器为R2，如果R1发出一个多播数据报，其目的地址是G的组地址，R2就向多播组G的成员转发这个多播数据报。如果R1发出的数据报是一个请求加入多播组G的数据报，R2就把这个信息加到它的路由中，并用隧道技术向R1转发每一个数据报的一个副本。 目前还没有在整个互联网范围使用的多播路由选择协议。下面是一些建议使用的多播路由选择协议。\n距离向量多播路由选择协议DVMRP（Distance Vector Multicast Routing Protocol）参考有关文档RFC 1075。 基于核心的转发树CBT（Core Based Tree)参考有关文档RFC 2189,2201。 开放最短通路优先的多播拓展MOSPF（Multicast extensions to OSPF）参考有关文档RFC 1585。 协议无关多播-稀疏方式PIM-SM（Protocol Independent Multicast-Spare Mode）参考有关文档RFC 4601。 协议无关多播-密集方式PIM-DM（Protocol Independent Multicast-Dense Mode)参考有关文档RFC 3973 参考文献：《计算机网络（第7版）》谢希仁著。\n","wordCount":"76","inLanguage":"en","datePublished":"2021-01-02T18:03:36Z","dateModified":"2021-01-02T18:03:36Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://yyf.zone/notes/2021-1-2-ipmulticast/"},"publisher":{"@type":"Organization","name":"Play With YYF","logo":{"@type":"ImageObject","url":"http://yyf.zone/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://yyf.zone/ accesskey=h title="Play With YYF (Alt + H)">Play With YYF</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>IP多播</h1><div class=post-meta><span title='2021-01-02 18:03:36 +0000 UTC'>January 2, 2021</span></div></header><div class=post-content><p>网络层/IP多播</p><h1 id=ip多播><strong>IP多播</strong><a hidden class=anchor aria-hidden=true href=#ip多播>#</a></h1><p>一个源点发送到多个终点，即<strong>一对多的通信</strong>。与单播相比，在一对多的通信中，多播可大大节约网络资源。</p><h2 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h2><ul><li>多播路由器(multicast router)</li></ul><blockquote><p>在互联网范围的多播要靠路由器来实现，这些路由起必须增加一些能够识别多播数据报的软件，能够运行多播协议的路由器称为多播路由器。多播路由器当然也可以转发普通的单播IP数据包</p></blockquote><ul><li>多播主干网(Multicast Backbone On the InterNET)</li></ul><blockquote><p>MBONE可把分组传播给地点分散但属于一个组的许多台主机。</p></blockquote><ul><li>多播地址</li></ul><blockquote><p>多播组的标识符就是IP地址中的D类地址。D类地址的前四位是1110，每一个D类地址标志一个多播组。多播地址只能用于目的地址，而不能用于源地址。</p></blockquote><ul><li>多播数据报</li></ul><blockquote><p>多播数据报和一般的IP数据报的区别就是它使用D类IP地址作为目的地址，并且首部中的协议字段值是2，表明使用网际组管理协议IGMP。此外，对多播数据报不产生ICMP差错报文。因此，若在PING命令后面键入多播地址，将永远不会收到响应。</p></blockquote><h2 id=局域网上的硬件多播>局域网上的硬件多播<a hidden class=anchor aria-hidden=true href=#局域网上的硬件多播>#</a></h2><p>D类IP地址与以太网多播地址的映射关系。互联网号码指派管理局IANA拥有的以太网地址块的高24位为00-00-5E，第一个字节的最低位为1时即为多播地址，即01-00-5E-00-00-00到01-00-5E-7F-FF-FF。<br>由于多播IP地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃。<br><img loading=lazy src=/image/test.png alt=D类地址与以太网多播地址的映射关系图></p><h2 id=3-网际组管理协议igmp>3. 网际组管理协议IGMP<a hidden class=anchor aria-hidden=true href=#3-网际组管理协议igmp>#</a></h2><p>IP多播需要两种协议，<strong>网际组管理协议IGMP</strong>和<strong>多播路由选择协议</strong>。IGMP协议并非在互联网范围内对所有多播组成员进行管理的协议。IGMP不知道多播组包含的成员数，也不知道这些成员都分布在那些网络上，等等。IGMP协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机（严格讲，是主机上的某个进程）参加或退出了某个多播组。<br>显然，仅有IGMP协议是不能完成多播任务的。连接在局域网上的多播路由器还必须和互联网上的其他多播路由器协同工作，这就需要<strong>多播路由选择协议</strong>。<br>IGMP协议和ICMP协议相似，使用<strong>IP数据报</strong>传递其报文。属于网际协议IP的一个组成部分。
IGMP的工作分成两个阶段：</p><ol><li>第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个IGMP报文，声明自己要称为改组成员。</li><li>第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否还继续是组的成员。</li></ol><p>IGMP协议还采取了一些措施来避免多播控制信息给网络增加大量的开销：</p><ol><li>在主机和多播路由器之间的所有通信都是使用IP多播。</li><li>多播路由器在探询组成员关系时，只需要对所有的组发送一个请求信息的询问报文，而不需要每个组都发送一个。</li><li>当同一个网络上连接有多个多播路由器时，它们能迅速和有效地选择其中的一个来探询主机的成员关系。</li><li>在IGMP的询问报文中有一个数值N，它指明一个最长响应时间。当收到询问时，主机在0到N之间随机选择发送响应所需要经过的时延。因此，若一台主机同时参加了多个多播组，则主机对每一个多播组选择不同的随机数。对应最小时延的响应最先发送。</li><li>同一组内的每一台主机都要监听响应，只要有本组的其他主机先发送了响应，自己就可以不再发送响应了。</li></ol><p>IGMP的报文格式可参阅有关文档<a href=https://tools.ietf.org/html/rfc3376>RFC 3376</a>。</p><h2 id=4-多播路由选择协议>4. 多播路由选择协议<a hidden class=anchor aria-hidden=true href=#4-多播路由选择协议>#</a></h2><p>多播路由选择协议实际上就是要找出以源主机为根节点的<strong>多播转发树</strong>。</p><ul><li>多播转发树</li></ul><blockquote><p>在多播转发树上，每一个多播路由器向树的叶节点方向转发收到的多播数据报，但在多播转发树上的路由器不会收到重复的多播数据报（即多播数据报不应在互联网中兜圈子）。</p></blockquote><p>已有多种实用的多播路由选择协议，它们在转发多播数据报时使用以下的三种方法;</p><ol><li><strong>泛洪与剪除</strong>。这种方法适合较小的多播组，而所有的组成员接入的局域网也是相邻接的。一开始，路由器转发多播数据报使用泛洪的方法（这就是广播）。<br>为避免兜圈子，采用<strong>反向路径广播</strong>RPB(Reverse Path Broadcasting)策略。RPB的要点是：每一个路由器在收到一个多播数据报时，先检查数据报是否是从源点经最短路径传送来的。进行这种检查很容易，只要从本路由器寻找到源点的最短路径上（之所以叫做反向路径，因为在计算最短路径时是把源点当作终点）的第一个路由器是否就是刚才把数据送来的路由器。若是，就向所有其他方向转发刚才收到的多播数据报，否则就丢弃而不转发。<br>如果在多播转发树上的某个路由器发现它的下游树枝（即叶节点方向）已没有该多播组的成员，就应把它和下游的树枝一起<strong>剪除</strong>。</li><li><strong>隧道技术</strong>。隧道技术适用于多播组在地理上很分散的情况。在通过不支持多播的网络时，将多播数据报进行再次封装，即加上普通数据报首部，使之成为向单一目的站发送<strong>单播</strong>数据报。通过该网络后，剥去首部，使它恢复成原来的多播数据报，继续向多个目的站转发。</li><li><strong>基于核心的发现技术</strong>。这种方法对于多播组的大小在较大范围内变化时都适合。这种方法是对每一个多播组G指定一个<strong>核心(core)路由器</strong>，给出它的IP单播地址。核心路由器按照前面讲过的方法创建出对应于多播组G的转发树。假设核心路由器为R2，如果R1发出一个多播数据报，其目的地址是G的组地址，R2就向多播组G的成员转发这个多播数据报。如果R1发出的数据报是一个请求加入多播组G的数据报，R2就把这个信息加到它的路由中，并用隧道技术向R1转发每一个数据报的一个副本。</li></ol><p>目前还没有在整个互联网范围使用的多播路由选择协议。下面是一些建议使用的多播路由选择协议。</p><ul><li>距离向量多播路由选择协议DVMRP（Distance Vector Multicast Routing Protocol）参考有关文档<a href=https://tools.ietf.org/html/rfc1075>RFC 1075</a>。</li><li>基于核心的转发树CBT（Core Based Tree)参考有关文档<a href=https://tools.ietf.org/html/rfc2189>RFC 2189,2201</a>。</li><li>开放最短通路优先的多播拓展MOSPF（Multicast extensions to OSPF）参考有关文档<a href=https://tools.ietf.org/html/rfc1585>RFC 1585</a>。</li><li>协议无关多播-稀疏方式PIM-SM（Protocol Independent Multicast-Spare Mode）参考有关文档<a href=https://tools.ietf.org/html/rfc4601>RFC 4601</a>。</li><li>协议无关多播-密集方式PIM-DM（Protocol Independent Multicast-Dense Mode)参考有关文档<a href=https://tools.ietf.org/html/rfc3973>RFC 3973</a></li></ul><p>参考文献：《计算机网络（第7版）》谢希仁著。</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://yyf.zone/tags/%E7%AC%94%E8%AE%B0/>笔记</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=http://yyf.zone/>Play With YYF</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>